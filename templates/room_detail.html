{% extends 'base.html' %} {% block content %}

<style>
  /* #chat-box p {
    margin: 0;
    padding: 3px 0;
  }

  #chat-box strong {
    color: #2b2bff;
  }

  #chat-box small {
    font-size: 0.8em;
  } */

  #chat-box {
    border: 1px solid #aaa;
    height: 300px;
    overflow-y: scroll;
    padding: 10px;
    background: #f9f9f9;
  }
  #chat-box p {
    margin: 0;
    padding: 3px;
    line-height: 1.5em;
  }
  strong {
    color: #1a73e8;
  }
</style>

<h2>Room: {{ room.name }}</h2>

<div id="chat-box" style="border: 1px solid #aaa; padding: 10px; height: 300px; overflow-y: scroll">
  {% for msg in messages %}
  <p>
    <strong>{{ msg.user.username }}:</strong> {{ msg.content }}
    <small style="color: gray">{{ msg.timestamp|date:"H:i" }}</small>
  </p>
  {% endfor %}
</div>

<form id="chat-form">
  <input type="text" id="message-input" placeholder="Type a message..." autocomplete="off" required />
  <button type="submit">Send</button>
</form>

<script>
  const roomName = "{{ room.name }}";
  const chatSocket = new WebSocket("ws://" + window.location.host + "/ws/chat/" + roomName + "/");

  chatSocket.onmessage = function (e) {
    const data = JSON.parse(e.data);
    const chatBox = document.getElementById("chat-box");
    chatBox.innerHTML += `<p><strong>${data.username}:</strong> ${data.message}</p>`;
    chatBox.scrollTop = chatBox.scrollHeight;
  };

  chatSocket.onclose = function (e) {
    console.error("Chat socket closed unexpectedly");
  };

  document.getElementById("chat-form").onsubmit = function (e) {
    e.preventDefault();
    const messageInput = document.getElementById("message-input");
    const message = messageInput.value;
    chatSocket.send(
      JSON.stringify({
        message: message,
      })
    );
    messageInput.value = "";
  };
</script>
<a href="{% url 'home' %}">â¬… Back to Home</a>
{% endblock %}
